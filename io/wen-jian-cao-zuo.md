#Python学习笔记 —— 文件操作

[TOC]

## 一、I/O概述

> I/O在计算机中是指Input/Output，也就是Stream(流)的输入和输出。这里的输入和输出是相对于内存来说的，Input Stream（输入流）是指数据从外（磁盘、网络）流进内存，Output Stream是数据从内存流出到外面（磁盘、网络）。程序运行时，数据都是在内存中驻留，由CPU这个超快的计算核心来执行，涉及到数据交换的地方（通常是磁盘、网络操作）就需要IO接口。
> 
> 操作系统屏蔽了底层硬件，向上提供通用接口。因此，操作I/O的能力是由操作系统的提供的，每一种编程语言都会把操作系统提供的低级C接口封装起来供开发者使用，Python也不例外。

### 1、文件读写实现原理

> 文件读写就是一种常见的IO操作。python封装了操作系统的底层接口，直接提供了文件读写相关的操作方法。而且Java、PHP等其他语言也是。
> 
> 操作对象：由于操作I/O的能力是有操作系统提供的，且现代操作系统不允许普通程序直接操作磁盘，所以读写文件时需要请求系统打开一个对象（通常被称为文件描述符--file descriptor, 简称fd），这就是我们在程序中要操作的文件对象。
> 
> 获取对象的方式：通常高级编程语言中会提供一个内置的函数，通过接收"文件路径"以及“文件打开模式”等参数来打开一个文件对象，并返回该文件对象的文件描述符。因此通过这个函数我们就可以获取要操作的文件对象了。这个内置函数在Python中叫open(), 在PHP中叫fopen()。

## 二、文件操作的基本流程

### 1、文件读写操作步骤

不同的编程语言读写文件的操作步骤大体都是一样的，都分为以下几个步骤：

```txt
1）打开文件，获取文件描述符

2）操作文件描述符--读/写

3）关闭文件
```

---

> **注意：文件读写操作完成后，应该及时关闭** 
>
> 一方面，文件对象会占用操作系统资源；另一方面，操作系统对同一时间能打开的文件描述符的数量是有限制的。
>
> 不及时关闭文件，还可能造成数据丢失。因为我们将数据写入文件时，操作系统不会立刻将文件写入磁盘中，而是存到缓存区异步写入磁盘。当调用close方法时，操作系统会保证把没有写入磁盘的数据全部写到磁盘上，否则可能会丢失数据。

```python
#实现文件复制
ori = input('请输入你要复制的文件名：')
temp = ori.rfind('.')
c_doc = ori[:temp] + "-copy" + ori[temp:]

f1 = open(ori,"r",encoding='utf8')
f2 = open(c_doc,"w",encoding='utf8')

while True:
    bit = f1.read(1)
    if bit == '':
        break
    f2.write(bit)

f2.close
f1.close
```



### 2、文件打开模式

文件打开模式 | 描述
--- | ---
r | 以只读模式打开文件，并将文件指针指向文件头；如果文件不存在会报错 
w | 以只写模式打开文件，并将文件指针指向文件头；如果文件存在则将其内容清空，如果文件不存在则创建
a | 以只追加可写模式打开文件，并将文件指针指向文件尾部；如果文件不存在则创建
 | 
r+ | 在r的基础上增加了可写功能
w+ | 在w的基础上增加了可读功能
a+ | 在a的基础上增加了可读功能
 | 
b | 读写二进制文件（默认是t，表示文本），需要与上面几种模式搭配使用，如ab，wb, ab, ab+（POSIX系统，包括Linux都会忽略该字符）

---

>  **注意： r+、w+和a+都可以实现对文件的读写，那么他们有什么区别呢？** 
>  
> r+：会覆盖当前文件指针所在位置的字符，如原来文件内容是"Hello，World"，打开文件后写入"hi"则文件内容会变成"hillo, World"
> 
> w+在打开文件时就会先将文件内容清空，不知道它有什么用
> 
> a+只能写到文件末尾（无论当前文件指针在哪里）

### 3、文件操作相关方法

read(size)：每次最多读取指定长度的内容，返回一个str，默认返回全部数据；在Python2中size指定的是字节长度，在Python3中size指定的是字符长度。

readline()：每次读取一行内容

readlines()：一次性读取文件中所有内容，按行返回一个list

write(str)：将字符串写入文件，没有返回值

定位光标的方法：

seek(n,m)：n操作指针移动距离；m操作指针大体位置，0为文件开头，1为光标原位置，2为文件末尾

tell()：获取当前文件指针所在位置

### 4、OS模块

```python
#批量修改文件名
import os
#1、获取要重命名的文件夹 名字
f_name = input("请输入要重命名的文件夹：")

#2、获取指定的文件夹中所有文件 名字
f_names = os.listdir(f_name)

os.chdir(f_name)

#3、重命名
for name in f_names:
    temp = name[name.find('-')+1:name.rfind('.')] + '-[' + name[1:name.find('-')] + ']' + name[name.rfind('.'):]
    os.rename(name,temp)
    print("更改后的名字为：" + temp)
```

